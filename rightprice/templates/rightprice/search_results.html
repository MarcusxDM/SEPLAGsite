<!DOCTYPE html>
<html>
  <head>
    <title>RIGHT PRICE</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    {% load staticfiles %}
    <link rel="stylesheet" href="{% static 'rightprice/rightpricestyle.css' %}">
    
    <style>
      img {
    	display: block;
    	max-width: 70%;
  		height: auto;
    	margin-left: auto;
    	margin-right: auto;
    }
    </style>
    {% load staticfiles %}
    <a href="/rightprice"><img src="{% static 'rightprice/rightprice.png' %}" alt="logo" height=90, widght=10/></a>
  <hr>
  </head>
  <body>
	 <form action="/rightprice">
	    <input type="submit" value="Voltar" />
	</form>
  <div id=table>
	  <div class="products">
		{% if results %}
		  {% for product in results %}
		   <h2><a id="prodList" href="/rightprice/{{ product.id }}/">{{ product.description }} <br>Preço Máximo: R$ {{ product.SellPriceMax }}</a></h2>
		  {% endfor %}
		{% else %}
		  <p>Desculpe, não foi encontrado nenhum produto com esta descrição</p>
		{% endif %}
	  </div>
	    <div id="map"></div>
  </div>
    <script>
      var map;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -9.6545916, lng: -35.715989},
          zoom: 13
        });
        
        {% if results %}
        var productList = []
		{% for productt in results %}
   		productList.push({
        	fantasiaName: '{{productt.fantasiaName}}',
        	latitudeNum:  {{productt.latitudeNum}},
        	longitudeNum: {{productt.longitudeNum}},
        	addressName:  '{{productt.addressName}}',
        	neighborhood: '{{productt.neighborhood}}',
        	cepNum:       '{{productt.cepNum}}' 
   		 })
		{% endfor %}
		
    	var product
    	for (i = 0; i<20; i++){
    		if (productList[i].fantasiaName != productList[i+1].fantasiaName){
		        var infowindow = new google.maps.InfoWindow({
		        	content: productList[i].fantasiaName+'<br><br>'+productList[i].addressName+'<br>'
		        	+productList[i].neighborhood+'<br>'+productList[i].cepNum,
		            position: {lat: productList[i].latitudeNum, lng: productList[i].longitudeNum}
		          });
		        infowindow.open(map);
		     } else {
		    	 var infowindow = new google.maps.InfoWindow({
			         content: productList[0].fantasiaName+'<br><br>'+productList[0].addressName+'<br>'
			         +productList[0].neighborhood+'<br>'+productList[0].cepNum,
			          position: {lat: productList[0].latitudeNum, lng: productList[0].longitudeNum}
			     });
			    infowindow.open(map);
		     }
		    	}
   		{% endif %}
      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyApMGZ2UbGB5OjHub7QCffJEjmI2jHIb0Y&callback=initMap"
    async defer></script>
  </body>
</html>